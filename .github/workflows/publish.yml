name: Deploy to Railway

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest


    steps:
      - name: Checkout repository
        uses: actions/checkout@v5


      - name: Debug - Show project structure
        run: |
          echo "ğŸ“ Repository root contents:"
          ls -la
          echo "ğŸ” Looking for package.json or other build files..."
          find . -maxdepth 3 -type f \( -name "package.json" -o -name "requirements.txt" -o -name "composer.json" \)

      - name: Install Railway CLI
        run: npm install -g @railway/cli



      - name: Install dependencies
        if: hashFiles('**/package-lock.json') != ''
        run: |
         echo "ğŸ“¦ Installing Node dependencies..."
         npm ci

      - name: Build project
        if: hashFiles('**/package.json') != ''
        run: |
          echo "ğŸ”¨ Running build step..."
          npm run build || echo "âš ï¸ No build script found, skipping"



      - name: Deploy to Railway
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN}}
        run: |
          echo "ğŸš€ Deploying to Railway..."
          railway up --yes

